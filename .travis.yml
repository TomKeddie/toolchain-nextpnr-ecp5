sudo: required
dist: bionic
language: cpp
matrix:
  include:
  - os: osx
    env: TARGET=darwin MACOSX_DEPLOYMENT_TARGET=10.10
    addons:
      homebrew:
        packages:
        - bison
        - flex
        - gawk
        - git
        - pkg-config
        - gnu-sed
        - wget
        - eigen
  - os: linux
    env: TARGET=linux_x86_64
before_script:
- if [[ ${TARGET:0:7} == "windows" ]]; then sudo dpkg --add-architecture i386; fi
- if [[ "$ARCH" == "linux_i686" ]]; then sudo dpkg --add-architecture i386; fi
- if [[ "$ARCH" == "linux_armv7l" ]]; then sudo dpkg --add-architecture armhf; fi
- if [[ "$ARCH" == "linux_aarch64" ]]; then sudo dpkg --add-architecture arm64; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update -y -qq; fi
script:
- bash build.sh $TARGET
- openssl sha1 _packages/**/*.tar.gz
deploy:
  provider: releases
  # - Create a `public_repo` GitHub token. Go to: https://github.com/settings/tokens/new
  # - Encrypt it: `travis encrypt 0123456789012345678901234567890123456789
  # - Paste the output down here
  api_key:
    secure: FVETr4lMQJ9CFLt+fIi5dI+hwtLNTE3VIQvgrFS4BgOXX5+tz98nv4txlZyzoDs4067+9jpQWXJtVKKu4p9KKjkMUFTZyWNS6ODcTEoxvOM4FIahcssRiUNAPZKO2x90Aml1Awe+wTGfuhG5hovwAYn5X03JfzJiackpUDwzC9xMyr5Rlq4Msp7F1h7iXaV5Vhs1vWpsh5ycur8zY1y5frJ87MxrU+CZ5VHratIrMikqt+zRr5TSaHNPMZuBphLcwTE+dxhlAgmLa2wEBQPUI/bGoikEDbc+Bxl4377nxGW+fEeWVQN2bkhrfLMI0I8qGtx9wN76BMeEIuYmW9f34ALpoR36xtsezETkUnhxESJTAAVpSymxB48TmK78LKBjyIoOwX+spopKc8dZaYMzvy7fhyhbXwTO+kIIuntvfoliL+I5im2T9PsKuC8KoykrTyxSpWrBdw8mrjpPbWRcVsUkkFuyAdKEqUb0Tb87WajOnxYMSYfAst58wvxm6Q/7GVBd1yLWj2qYLytjRXAJ0cQ3ZGLfFsIxh+sifBGApIg+m0/ewdwnKapExZU1fBT7nhZP0P90JK0y6cdNkKTBkF9ufDkcghESRRIsFBJ8Jul1/C0kyW7hKmEsGMYep8OdNHmmP56e0MWrY4wr5enWMwyjNX1ZJUEDjRU+b8lN8CM=
  file:
    - _packages/**/*.tar.gz
    - _packages/**/*.zip
  file_glob: true
  skip_cleanup: true
  on:
    repo: xobs/toolchain-nextpnr-ecp5
    all_branches: true
    tags: true
branches:
  only:
    # Release tags
    - /^v\d+\.\d+/
    - master
notifications:
  email:
    on_success: change